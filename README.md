# Bç«™åŠ¨æ€ç›‘æ§æœºå™¨äºº V2

## ğŸš€ é¡¹ç›®ç®€ä»‹

Bç«™åŠ¨æ€ç›‘æ§æœºå™¨äººV2æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„Bç«™UPä¸»åŠ¨æ€ç›‘æ§å·¥å…·ï¼Œæ”¯æŒè‡ªåŠ¨æ¨é€æ–°åŠ¨æ€åˆ°é’‰é’‰ç¾¤ã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§
- **ğŸ¯ è¶…é«˜æ•ˆç›‘æ§** - APIè¯·æ±‚å‡å°‘66%+ï¼Œå“åº”é€Ÿåº¦æå‡30å€
- **âš¡ æ™ºèƒ½æ£€æµ‹** - å…¨å±€åŠ¨æ€æ£€æµ‹ + æ‰¹é‡æ¨é€æœºåˆ¶
- **ğŸ”„ å¤šç±»å‹ç›‘æ§** - æ”¯æŒåŠ¨æ€å’Œè§†é¢‘åŒé‡ç›‘æ§
- **ğŸ’¬ é’‰é’‰æ¨é€** - è‡ªåŠ¨æ ¼å¼åŒ–æ¶ˆæ¯æ¨é€åˆ°é’‰é’‰ç¾¤
- **ğŸ—ƒï¸ å»é‡æœºåˆ¶** - è‡ªåŠ¨è¿‡æ»¤é‡å¤å’Œç½®é¡¶åŠ¨æ€
- **ğŸ“Š ç»Ÿè®¡åŠŸèƒ½** - å®æ—¶ç›‘æ§ç»Ÿè®¡å’Œæ—¥å¿—è®°å½•

---

## ğŸ“± æ•ˆæœå±•ç¤º

æ¨é€åˆ°é’‰é’‰ç¾¤çš„æ¶ˆæ¯æ•ˆæœç¤ºä¾‹ï¼š

![é’‰é’‰æ¨é€æ•ˆæœ](IMG_4936_å‰¯æœ¬.jpg)

æ¶ˆæ¯åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
- ğŸ“ åŠ¨æ€ç±»å‹ï¼ˆå›¾ç‰‡åŠ¨æ€/è§†é¢‘/è½¬å‘ç­‰ï¼‰
- ğŸ‘¤ UPä¸»æ˜µç§°
- â° å‘å¸ƒæ—¶é—´
- ğŸ“Œ åŠ¨æ€æ ‡é¢˜
- ğŸ“„ åŠ¨æ€å†…å®¹

---

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
bili/
â”œâ”€â”€ æ ¸å¿ƒç¨‹åºæ–‡ä»¶ (5ä¸ª)
â”‚   â”œâ”€â”€ main_v2.py          # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ bili_api_v2.py      # Bç«™APIæ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ dingtalk_sender.py  # é’‰é’‰æ¶ˆæ¯æ¨é€æ¨¡å—
â”‚   â”œâ”€â”€ database.py         # æ•°æ®åº“ç®¡ç†æ¨¡å—
â”‚   â””â”€â”€ config.py           # é…ç½®ç®¡ç†æ¨¡å—
â”‚
â”œâ”€â”€ é…ç½®å’Œä¾èµ– (2ä¸ª)
â”‚   â”œâ”€â”€ config_v2.json      # ä¸»é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ requirements_v2.txt # Pythonä¾èµ–æ¸…å•
â”‚
â”œâ”€â”€ å¯åŠ¨è„šæœ¬ (1ä¸ª)
â”‚   â””â”€â”€ å¯åŠ¨ç›‘æ§.bat        # ä¸€é”®å¯åŠ¨è„šæœ¬ï¼ˆå«é…ç½®å‘å¯¼ï¼‰
â”‚
â””â”€â”€ è¿è¡Œæ—¶æ–‡ä»¶ (è‡ªåŠ¨ç”Ÿæˆ)
    â”œâ”€â”€ sent_dynamics.db    # SQLiteæ•°æ®åº“
    â””â”€â”€ bili_monitor.log    # è¿è¡Œæ—¥å¿—
```

**æ€»è®¡ï¼š8ä¸ªæ ¸å¿ƒæ–‡ä»¶**

---

## ğŸ”§ å®‰è£…æŒ‡å—

### 1. å®‰è£…Python

**ç¯å¢ƒè¦æ±‚ï¼š** Python 3.7+ (æ¨è Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬)

**å®‰è£…æ•™ç¨‹è¯·å‚è€ƒï¼š**
- [å»–é›ªå³°Pythonæ•™ç¨‹ - å®‰è£…Python](https://liaoxuefeng.com/books/python/install/index.html)
- [Pythonå®˜æ–¹ä¸‹è½½](https://www.python.org/downloads/)

**éªŒè¯å®‰è£…ï¼š**
```bash
# Windows
python --version

# macOS/Linux
python3 --version
```

### 2. å®‰è£…é¡¹ç›®ä¾èµ–

```bash
# Windowsï¼ˆä½¿ç”¨æ¸…åæºï¼Œé€Ÿåº¦æ›´å¿«ï¼‰
pip install -r requirements_v2.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# macOS/Linuxï¼ˆä½¿ç”¨æ¸…åæºï¼Œé€Ÿåº¦æ›´å¿«ï¼‰
pip3 install -r requirements_v2.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ï¼šconfig_v2.json

```json
{
  "dingtalk": {
    "webhook_url": "é’‰é’‰æœºå™¨äººWebhookåœ°å€",
    "secret": "åŠ ç­¾å¯†é’¥ï¼ˆå¯é€‰ï¼‰"
  },
  "bilibili": {
    "cookie_string": "å®Œæ•´çš„Bç«™Cookieå­—ç¬¦ä¸²",
    "up_list": [
      {
        "uid": "UPä¸»UID",
        "name": "UPä¸»æ˜µç§°", 
        "enabled": true,
        "monitor_types": ["dynamic", "video"]
      }
    ],
    "global_update_check_interval_minutes": 1,
    "check_interval_minutes": 5,
    "api_settings": {
      "min_interval": 3.0,
      "request_timeout": 15,
      "retry_count": 3
    }
  },
  "database": {
    "file": "sent_dynamics.db",
    "cleanup_days": 30
  },
  "logging": {
    "level": "INFO",
    "file": "bili_monitor.log",
    "max_size_mb": 10,
    "backup_count": 5
  }
}
```

---

### 1. é’‰é’‰æœºå™¨äººé…ç½®

#### å¦‚ä½•åˆ›å»ºé’‰é’‰æœºå™¨äºº

**è¯¦ç»†æ•™ç¨‹è¯·å‚è€ƒé’‰é’‰å®˜æ–¹æ–‡æ¡£ï¼š**
- [è‡ªå®šä¹‰æœºå™¨äººåˆ›å»ºå’Œå®‰è£…](https://open.dingtalk.com/document/orgapp/custom-bot-creation-and-installation)
- [è·å–è‡ªå®šä¹‰æœºå™¨äººWebhookåœ°å€](https://open.dingtalk.com/document/orgapp/obtain-the-webhook-address-of-a-custom-robot)

#### é…ç½®æ­¥éª¤ï¼ˆç®€è¦ï¼‰

1. **è¿›å…¥ç¾¤è®¾ç½®** â†’ æ™ºèƒ½ç¾¤åŠ©æ‰‹ â†’ æ·»åŠ æœºå™¨äºº â†’ è‡ªå®šä¹‰æœºå™¨äºº
2. **é…ç½®å®‰å…¨è®¾ç½®**ï¼ˆå¿…é€‰å…¶ä¸€ï¼‰ï¼š
   - â­ åŠ ç­¾ï¼ˆæ¨èï¼‰ï¼šå¤åˆ¶ç”Ÿæˆçš„Secretå¯†é’¥
   - è‡ªå®šä¹‰å…³é”®è¯ï¼šè®¾ç½®å…³é”®è¯å¦‚"åŠ¨æ€"ã€"è§†é¢‘"
   - IPåœ°å€ç™½åå•ï¼šå¡«å†™æœåŠ¡å™¨IP
3. **è·å–Webhookåœ°å€**ï¼šå¤åˆ¶ç”Ÿæˆçš„Webhook URL
4. **å¡«å…¥é…ç½®æ–‡ä»¶**ï¼š
   ```json
   {
     "dingtalk": {
       "webhook_url": "https://oapi.dingtalk.com/robot/send?access_token=ä½ çš„token",
       "secret": "SECä½ çš„åŠ ç­¾å¯†é’¥ï¼ˆå¦‚æœä½¿ç”¨åŠ ç­¾ï¼‰"
     }
   }
   ```

#### æµ‹è¯•è¿æ¥

```bash
# Windows
python main_v2.py test

# macOS/Linux
python3 main_v2.py test
```

---

### 2. Bç«™Cookieé…ç½®

#### è·å–Cookie

1. æµè§ˆå™¨ç™»å½•Bç«™ (https://www.bilibili.com)
2. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° `Network` æ ‡ç­¾é¡µï¼Œåˆ·æ–°é¡µé¢
4. ç‚¹å‡»ä»»æ„è¯·æ±‚ï¼Œæ‰¾åˆ° `Request Headers` ä¸­çš„ `Cookie`
5. å¤åˆ¶å®Œæ•´Cookieå­—ç¬¦ä¸²åˆ°é…ç½®æ–‡ä»¶

**é…ç½®ç¤ºä¾‹ï¼š**
```json
{
  "bilibili": {
    "cookie_string": "SESSDATA=xxx; bili_jct=xxx; DedeUserID=xxx; ..."
  }
}
```

**æ³¨æ„ï¼š** Cookieæœ‰æ•ˆæœŸé€šå¸¸ä¸º2-6ä¸ªæœˆï¼Œè¿‡æœŸåéœ€é‡æ–°è·å–

---

### 3. UPä¸»ç›‘æ§é…ç½®

#### æ·»åŠ è¦ç›‘æ§çš„UPä¸»

```json
{
  "up_list": [
    {
      "uid": "322005137",           // UPä¸»UIDï¼ˆä»ä¸»é¡µURLè·å–ï¼‰
      "name": "å½±è§†é£“é£",            // UPä¸»æ˜µç§°
      "enabled": true,               // æ˜¯å¦å¯ç”¨
      "monitor_types": ["dynamic", "video"]  // ç›‘æ§ç±»å‹
    }
  ]
}
```

**é…ç½®è¯´æ˜ï¼š**
- `uid`ï¼šUPä¸»UIDï¼Œè®¿é—®ä¸»é¡µURLæŸ¥çœ‹ï¼Œå¦‚ `https://space.bilibili.com/322005137`
- `monitor_types`ï¼š
  - `["dynamic"]` - ä»…ç›‘æ§åŠ¨æ€
  - `["video"]` - ä»…ç›‘æ§è§†é¢‘
  - `["dynamic", "video"]` - åŒæ—¶ç›‘æ§ï¼ˆæ¨èï¼‰

---

### 4. ç›‘æ§é¢‘ç‡é…ç½®

#### æ¨èé…ç½®ï¼ˆæ ¹æ®ç›‘æ§UPä¸»æ•°é‡ï¼‰

| UPä¸»æ•°é‡ | global_check (åˆ†é’Ÿ) | check_interval (åˆ†é’Ÿ) | min_interval (ç§’) |
|---------|--------------------|--------------------|------------------|
| 1-3ä¸ª   | 1                  | 5                  | 3.0              |
| 4-10ä¸ª  | 2                  | 10                 | 4.0              |
| 10+ä¸ª   | 3                  | 15                 | 5.0              |

**é…ç½®å‚æ•°è¯´æ˜ï¼š**
- `global_update_check_interval_minutes`ï¼šå…¨å±€æ£€æµ‹é—´éš”ï¼ˆæ¨è1-3åˆ†é’Ÿï¼‰
- `check_interval_minutes`ï¼šå®Œæ•´æ£€æŸ¥é—´éš”ï¼ˆæ¨è5-15åˆ†é’Ÿï¼‰
- `api_settings.min_interval`ï¼šAPIè¯·æ±‚æœ€å°é—´éš”ï¼ˆæ¨è3-5ç§’ï¼Œé˜²æ­¢é™æµï¼‰

**ç¤ºä¾‹é…ç½®ï¼ˆ4-10ä¸ªUPä¸»ï¼‰ï¼š**
```json
{
  "global_update_check_interval_minutes": 2,
  "check_interval_minutes": 10,
  "api_settings": {
    "min_interval": 4.0,
    "request_timeout": 15,
    "retry_count": 3
  }
}
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨ç›‘æ§

```bash
# Windows - åŒå‡»è¿è¡Œ
å¯åŠ¨ç›‘æ§.bat

# æˆ–å‘½ä»¤è¡Œå¯åŠ¨
python main_v2.py start

# macOS/Linux
python3 main_v2.py start
```

### æµ‹è¯•é…ç½®

```bash
# Windows
python main_v2.py test

# macOS/Linux
python3 main_v2.py test
```

### æŸ¥çœ‹æ—¥å¿—

è¿è¡Œæ—¥å¿—ä¿å­˜åœ¨ `bili_monitor.log` æ–‡ä»¶ä¸­ã€‚

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [å»–é›ªå³°Pythonæ•™ç¨‹ - å®‰è£…Python](https://liaoxuefeng.com/books/python/install/index.html)
- [Pythonå®˜æ–¹ç½‘ç«™](https://www.python.org/downloads/)
- [é’‰é’‰è‡ªå®šä¹‰æœºå™¨äººåˆ›å»ºå’Œå®‰è£…](https://open.dingtalk.com/document/orgapp/custom-bot-creation-and-installation)
- [è·å–é’‰é’‰æœºå™¨äººWebhookåœ°å€](https://open.dingtalk.com/document/orgapp/obtain-the-webhook-address-of-a-custom-robot)

---

**ğŸ‰ äº«å—é«˜æ•ˆçš„Bç«™åŠ¨æ€ç›‘æ§ä½“éªŒï¼**
